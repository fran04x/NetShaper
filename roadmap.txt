# ROADMAP DE DESARROLLO: NETSHAPER
**Versión:** 1.0
**Arquitectura:** Layered (Capas)
**Stack:** C# .NET 8 / WinDivert / WPF

---

## FASE 1: El Núcleo de Red (Core Network Layer)
*Objetivo: Comunicación estable con el Kernel y gestión de memoria.*

1. **Native Interop (Capa 0)**
   - Definición estricta de structs (IPv4, IPv6, TCP, UDP).
   - P/Invoke para funciones exportadas de `WinDivert.dll`.
   - Gestión de `unsafe` pointers.

2. **Engine Lifecycle (Capa 1)**
   - Gestión de hilos `LongRunning`.
   - Implementación de `CancellationToken` para paradas limpias (Anti-Zombies).
   - Inyección dinámica de filtros de texto.

**Entregable:** Consola capaz de iniciar/detener el driver 50 veces consecutivas sin errores de memoria (0xc0000005) ni CPU al 100%.

---

## FASE 2: Lógica de Manipulación (Packet Processing Layer)
*Objetivo: Algoritmos de modificación de tráfico y efectos de red.*

1. **Pipeline de Efectos**
   - Arquitectura "Chain of Responsibility" para ordenar efectos simultáneos.

2. **Módulos de Efectos (Features)**
   - **Drop:** Algoritmo de pérdida de paquetes basado en probabilidad (RNG).
   - **Lag:** Sistema de colas (`ConcurrentQueue`) para retención asíncrona.
   - **Packet Stacking (Nuevo):** Acumulación de paquetes en buffer para liberación en "burst".
   - **Time Humanizer (Nuevo):** Variación aleatoria (`+/- 10%`) en los tiempos de lag.
   - **Pulse & Macro Sequencer (Nuevo):** Máquina de estados para ráfagas intermitentes y secuencias programadas.

**Entregable:** Pruebas verificadas con `Tester` mostrando latencia variable, pérdida y ráfagas controladas.

---

## FASE 3: Integración del Sistema (System Services Layer)
*Objetivo: Interacción con el SO fuera del driver de red.*

1. **Process Selector (Auto-Detect)**
   - Mapeo de `PID` a `Puerto/IP` usando APIs de Windows (`GetExtendedTcpTable`).
   - Selección de proceso (.exe) para auto-configurar filtros.

2. **Input Service (Controller Support)**
   - Implementación de `XInput` (Xbox/PlayStation controllers).
   - Binding de botones del mando a triggers del Engine.

**Entregable:** Detección automática de puertos de juegos y activación de lag mediante mando.

---

## FASE 4: Persistencia y Configuración (Data Layer)
*Objetivo: Almacenamiento de estado y preferencias.*

1. **Profile Manager**
   - Serialización JSON para perfiles de usuario (ej: "Perfil Minecraft").
   - Guardado/Carga de parámetros de efectos.

2. **Settings Manager**
   - Preferencias globales (Hotkeys custom, comportamiento de inicio).

**Entregable:** Persistencia de datos entre reinicios de la aplicación.

---

## FASE 5: Interfaz de Usuario (Presentation Layer)
*Objetivo: Interfaz gráfica WPF y UX avanzada.*

1. **Dashboard Principal**
   - Controles visuales para todos los parámetros del Engine.

2. **Visualización en Tiempo Real**
   - Gráfico de líneas (PPS / Latencia) renderizado en vivo.

3. **Sistema de Overlay**
   - Ventana `TopMost` transparente sobre juegos.
   - Slider de control de opacidad.

4. **System Tray**
   - Minimizar al área de notificación y control por menú contextual.

**Entregable:** Aplicación .exe completa con GUI funcional.

---

## FASE 6: Seguridad y Privacidad (Privacy Layer)
*Objetivo: Refinamiento para entornos de producción/streaming.*

1. **Streamer Mode**
   - Ocultación de ventana en OBS (`SetWindowDisplayAffinity`).
   - Enmascaramiento de IPs en la UI (`***.***`).
   - Renombrado falso de la ventana en Taskbar.

2. **Watchdogs**
   - Timers de seguridad para auto-apagado tras inactividad o tiempo límite.

**Entregable final:** Release Candidate estable y segura.